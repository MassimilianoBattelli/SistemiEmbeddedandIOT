<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ==" crossorigin = "anonymous" referrerpolicy = "no-referrer"> </script>
</head>
<body>
    <h1>Progetto d'esame IOT</h1>
    <table>
        <tr>
          <th>Sensore</th>
          <th>Temperatura</th>
        </tr>
      </table>
    <button id="button">Click Me</button>
    <button type = "button" onclick = "CreateTextFile();">Create Text File</button>
</body>
</html>
<script src="./JS.js"></script>
<script>
  function CreateTextFile() {
         var blob = new Blob(arr, {
            type: "text/plain;charset=utf-8",
         });
         saveAs(blob, "download.txt");
  }

  var arr = [];
  let table = document.querySelector("table");
  
  const client = mqtt.connect('wss://iotunibo:Vq95BxxTQkHlkcJS@iotunibo.cloud.shiftr.io', {
  clientId: 'WebServer'
  });

  client.on('connect', function() {
    console.log('connected!');
    client.subscribe('Topic');
  });

  client.on('message', function(topic, message) {
    console.log(topic + ': ' + message.toString());
    arr.push(message.toString());
    console.log(arr);
    generateTable(table, message.toString());
  });
  
  document.querySelector('button').addEventListener('click', function() {
    client.publish('Topic', 'messaggiodalWebServer');
    //generateTable(table, arr);
  });
  
  function generateTable(table, element) {
          let row = table.insertRow();
          let cell = row.insertCell();
          let text = document.createTextNode(element.toString());
          cell.appendChild(text);   
  }
</script>

